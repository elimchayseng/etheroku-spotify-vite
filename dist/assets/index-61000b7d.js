(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const m="f3ab9fbdd61342c0b05ff2e4d1d7a5e9",C=new URLSearchParams(window.location.search),d=C.get("code");async function k(e){const o=v(128),n=await I(o);localStorage.setItem("verifier",o);const t=new URLSearchParams;t.append("client_id",e),t.append("response_type","code"),t.append("redirect_uri","https://etheroku-spotify-vite.herokuapp.com/callback"),t.append("scope","user-read-private user-read-email user-read-recently-played user-top-read"),t.append("code_challenge_method","S256"),t.append("code_challenge",n),document.location=`https://accounts.spotify.com/authorize?${t.toString()}`}function v(e){let o="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<e;t++)o+=n.charAt(Math.floor(Math.random()*n.length));return o}async function I(e){const o=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",o);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(n)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function f(e,o){const n=localStorage.getItem("verifier"),t=new URLSearchParams;t.append("client_id",e),t.append("grant_type","authorization_code"),t.append("code",o),t.append("redirect_uri","https://etheroku-spotify-vite.herokuapp.com/callback"),t.append("code_verifier",n);const a=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}),{access_token:r}=await a.json();return r}async function g(e){return await(await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${e}`}})).json()}async function y(e){const t=(await(await fetch("https://api.spotify.com/v1/me/player/recently-played?limit=30",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).json()).items.map(l=>({title:l.track.name,artist:l.track.artists[0].name,album:l.track.album.name}));console.log("Here are the Recent Tracks:"),console.log(t);const i=(await(await fetch("https://api.spotify.com/v1/me/top/tracks?time_range=short_term&limit=30",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).json()).items.map(l=>({title:l.name,artist:l.artists[0].name,album:l.album.name}));return console.log("Here are the Top Tracks:"),console.log(i),{topTracks:i,recentTracks:t}}function T(e,o){const n=document.createElement("table"),t=["Top 30 Title","Top 30 Artist","Top 30 Album"],a=document.createElement("tr");t.forEach(c=>{const s=document.createElement("th");s.textContent=c,a.appendChild(s)}),n.appendChild(a),e.forEach(c=>{const s=document.createElement("tr");s.innerHTML=`
      <td>${c.title}</td>
      <td>${c.artist}</td>
      <td>${c.album}</td>
    `,n.appendChild(s)});const r=document.getElementById("topTable");r.innerHTML="",r.appendChild(n);const i=document.createElement("table"),l=["Recent Title","Recent Artist","Recent Album"],u=document.createElement("tr");l.forEach(c=>{const s=document.createElement("th");s.textContent=c,u.appendChild(s)}),i.appendChild(u),o.forEach(c=>{const s=document.createElement("tr");s.innerHTML=`
      <td>${c.title}</td>
      <td>${c.artist}</td>
      <td>${c.album}</td>
    `,i.appendChild(s)});const h=document.getElementById("recentTable");h.innerHTML="",h.appendChild(i)}function w(e){if(document.getElementById("displayName").innerText=e.display_name,e.images[0]){const o=new Image(200,200);o.src=e.images[0].url,document.getElementById("avatar").appendChild(o)}document.getElementById("id").innerText=e.id,document.getElementById("email").innerText=e.email,document.getElementById("uri").innerText=e.uri,document.getElementById("uri").setAttribute("href",e.external_urls.spotify),document.getElementById("url").innerText=e.href,document.getElementById("url").setAttribute("href",e.href),document.getElementById("imgUrl").innerText=e.images[0]?.url??"(no profile image)"}function b(e,o){const n=[];return e.forEach(t=>{o.some(r=>r.title===t.title&&r.artist===t.artist&&r.album===t.album)?n.push(t):console.log("No Matches")}),n}const p=document.getElementById("spotify-login-button"),E=document.getElementById("landing-page");p.addEventListener("click",async()=>{console.log("CLICK"),console.log(d),await k(m);const e=await f(m,d),o=await g(e);o&&(p.remove(),E.remove()),w(o);const n=await y(e);console.log(n),T(n.topTracks,n.recentTracks);const t=b(n.topTracks,n.recentTracks);console.log(t)});d?await B():document.body.appendChild(p);async function B(){const e=await f(m,d),o=await g(e);o&&(p.remove(),E.remove()),w(o);const n=await y(e);console.log(n),T(n.topTracks,n.recentTracks);const t=b(n.topTracks,n.recentTracks);console.log(t)}
