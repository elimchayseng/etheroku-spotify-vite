(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function a(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(o){if(o.ep)return;o.ep=!0;const c=a(o);fetch(o.href,c)}})();function y(e,n){const a=document.createElement("table"),t=["Top 30 Title","Top 30 Artist","Top 30 Album"],o=document.createElement("tr");t.forEach(s=>{const l=document.createElement("th");l.textContent=s,o.appendChild(l)}),a.appendChild(o),e.forEach(s=>{const l=document.createElement("tr");l.innerHTML=`
          <td>${s.title}</td>
          <td>${s.artist}</td>
          <td>${s.album}</td>
        `,a.appendChild(l)});const c=document.getElementById("topTable");c.innerHTML="",c.appendChild(a);const r=document.createElement("table"),m=["Recent Title","Recent Artist","Recent Album"],d=document.createElement("tr");m.forEach(s=>{const l=document.createElement("th");l.textContent=s,d.appendChild(l)}),r.appendChild(d),n.forEach(s=>{const l=document.createElement("tr");l.innerHTML=`
          <td>${s.title}</td>
          <td>${s.artist}</td>
          <td>${s.album}</td>
        `,r.appendChild(l)});const i=document.getElementById("recentTable");i.innerHTML="",i.appendChild(r)}async function T(e){const n=w(128),a=await E(n);localStorage.setItem("verifier",n);const t=new URLSearchParams;t.append("client_id",e),t.append("response_type","code"),t.append("redirect_uri","http://127.0.0.1:5173/callback"),t.append("scope","user-read-private user-read-email user-read-recently-played user-top-read"),t.append("code_challenge_method","S256"),t.append("code_challenge",a),document.location=`https://accounts.spotify.com/authorize?${t.toString()}`}function w(e){let n="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<e;t++)n+=a.charAt(Math.floor(Math.random()*a.length));return n}async function E(e){const n=new TextEncoder().encode(e),a=await window.crypto.subtle.digest("SHA-256",n);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(a)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function h(e,n){const a=localStorage.getItem("verifier"),t=new URLSearchParams;t.append("client_id",e),t.append("grant_type","authorization_code"),t.append("code",n),t.append("redirect_uri","http://127.0.0.1:5173/callback"),t.append("code_verifier",a);const o=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}),{access_token:c}=await o.json();return c}async function b(e){return await(await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${e}`}})).json()}function I(e){if(document.getElementById("displayName").innerText=e.display_name,e.images[0]){const n=new Image(200,200);n.src=e.images[0].url,document.getElementById("avatar").appendChild(n)}document.getElementById("id").innerText=e.id,document.getElementById("email").innerText=e.email,document.getElementById("uri").innerText=e.uri,document.getElementById("uri").setAttribute("href",e.external_urls.spotify),document.getElementById("url").innerText=e.href,document.getElementById("url").setAttribute("href",e.href),document.getElementById("imgUrl").innerText=e.images[0]?.url??"(no profile image)"}async function C(e){const n=new Date;n.setHours(0,0,0,0);const a=Math.floor(n.getTime()/1e3);console.log(a);const c=(await(await fetch("https://api.spotify.com/v1/me/player/recently-played?limit=50",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).json()).items.map(i=>({title:i.track.name,artist:i.track.artists[0].name,album:i.track.album.name})),d=(await(await fetch("https://api.spotify.com/v1/me/top/tracks?time_range=short_term&limit=30",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).json()).items.map(i=>({title:i.name,artist:i.artists[0].name,album:i.album.name}));return console.log(c),{topTracks:d,recentTracks:c}}function B(e,n){const a=[];e.forEach(r=>{n.some(d=>d.title===r.title&&d.artist===r.artist&&d.album===r.album)?a.push(r):console.log("Not a match")}),console.log(a);const t=JSON.stringify(a);console.log(t);const o=c(t);console.log(o);function c(r){const m=JSON.parse(r),d="rowdyDEVroadtrip",i={};let s=1;return m.forEach(l=>{const g=`match${d}_${s}`;i[g]=l,s++}),i}return a}const p="f3ab9fbdd61342c0b05ff2e4d1d7a5e9",v=new URLSearchParams(window.location.search),u=v.get("code"),f=document.getElementById("spotify-login-button"),_=document.getElementById("landing-page");if(u){const e=await h(p,u),n=await b(e);I(n);const a=await C(e);y(a.topTracks,a.recentTracks);const t=B(a.topTracks,a.recentTracks);if(console.log(t),t){const o=document.getElementById("match-element");o.textContent=JSON.stringify(t)}else{const o=document.getElementById("match-element");o.textContent="You haven't listened to any of your top songs today"}f.remove(),_.remove()}else{f.addEventListener("click",async()=>{await e()});async function e(){console.log(u),await T(p);const n=await h(p,u);localStorage.setItem("accessToken",n)}}
